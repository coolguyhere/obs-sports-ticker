<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sports Ticker — ESPN Style</title>

<style>
:root{
  --bar-h: 52px;
  --bg: #0f0f10;
  --text: #ffffff;
  --pill-bg: #242424;
  --pill-pad: 8px 16px;
  --sep: 20px;
  --round-bg: #222;
  --round-text: #fff;
  --font: 24px;
  --pill-radius: 4px;

  /* LIVE badge */
  --live-font-size: 13px;
  --live-subfont-size: 14px;
  --live-color: #ff4b4b;

  /* PST pill */
  --pst-bg: #1f4b8f;
  --pst-text: #fff;
}

/* Page */
html,body{
  height:100%;
  margin:0;
  background:#000;
  font-family:Arial,Helvetica,sans-serif;
  color:var(--text);
}

/* Bottom wrapper */
.ticker-wrapper{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  z-index:9999;
  pointer-events:none;
}

/* Bar */
.ticker-bar{
  height:var(--bar-h);
  background:var(--bg);
  display:flex;
  align-items:center;
  border-top:3px solid #c00;
  overflow:hidden;
  pointer-events:auto;
}

/* Viewport */
.rail-viewport{
  position:relative;
  width:100%;
  height:var(--bar-h);
  overflow:hidden;
  white-space:nowrap;
}

/* Rails */
#rail, #rail-dup, #rail-staging{
  position:absolute;
  top:0;
  left:0;
  display:inline-flex;
  align-items:center;
  height:var(--bar-h);
  will-change:transform;
}

/* Pills */
.pill{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--pill-bg);
  color:var(--text);
  padding:var(--pill-pad);
  margin-right:var(--sep);
  border-radius:var(--pill-radius);
  font-size:var(--font);
  height:calc(var(--bar-h) - 12px);
  border:1px solid rgba(255,255,255,0.12);
  box-shadow:0 0 6px rgba(0,0,0,0.45);
  gap:10px;
}

/* PST pill */
.pst-pill{
  background:var(--pst-bg);
  color:var(--pst-text);
  font-weight:700;
  text-transform:uppercase;
  padding:6px 12px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,0.06);
  box-shadow:0 2px 8px rgba(0,0,0,0.35);
  font-size:14px;
}

/* Header pill */
.header-pill{
  background:var(--round-bg);
  color:var(--round-text);
  font-weight:700;
  text-transform:uppercase;
  padding-left:14px;
  padding-right:14px;
}

/* Logos (+5% larger) */
.team-logo,
.pill img.logo{
  height:calc(var(--bar-h) * 0.58);
  width:auto;
  margin:0 6px;
  border:1px solid rgba(255,255,255,0.25);
  border-radius:6px;
  background:rgba(255,255,255,0.05);
}

/* Status inline (right side) */
.status-inline{
  display:flex;
  align-items:center;
  gap:10px;
  margin-left:auto;
}

/* Score pair */
.score-pair{
  display:flex;
  gap:6px;
  align-items:center;
  font-weight:700;
  font-size:var(--font);
}

/* LIVE/Q-H stack */
.status-stack{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-width:56px;
  line-height:1;
}
.status-main{
  font-weight:700;
  color:var(--live-color);
  font-size:var(--live-font-size);
}
.status-sub{
  font-size:var(--live-subfont-size);
  color:var(--text);
  opacity:0.95;
  margin-top:2px;
}

/* FINAL badge (ESPN style) */
.final-badge{
  background:#d32f2f;
  color:#fff;
  font-weight:700;
  padding:2px 6px;
  border-radius:4px;
  font-size:14px;
  letter-spacing:0.5px;
  text-transform:uppercase;
}

/* FINAL score */
.score-text{
  font-size:var(--font);
  font-weight:700;
  white-space:nowrap;
}

/* Responsive */
@media (max-width:520px){
  :root{
    --font:18px;
    --bar-h:44px;
    --pill-pad:6px 10px;
    --sep:14px;
    --live-font-size:12px;
    --live-subfont-size:12px;
  }
  .team-logo,
  .pill img.logo{
    height:calc(var(--bar-h) * 0.58);
  }
  .pst-pill{
    font-size:12px;
    padding:6px 10px;
  }
}
</style>
</head>
<body>

<div class="ticker-wrapper">
  <div class="ticker-bar" id="tickerBar">
    <div class="rail-viewport" id="viewport">
      <div id="rail"></div>
      <div id="rail-dup"></div>
      <div id="rail-staging" style="display:none;"></div>
    </div>
  </div>
</div>

<script>
/* CONFIG */
const LEAGUES = [
  { name:"NFL", key:"nfl", url:"https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard" },
  { name:"NBA", key:"nba", url:"https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard" },
  { name:"MLB", key:"mlb", url:"https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard" },
  { name:"NHL", key:"nhl", url:"https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard" }
];

const LEAGUE_LOGOS = {
  nfl:"https://a.espncdn.com/i/teamlogos/leagues/500/nfl.png",
  nba:"https://a.espncdn.com/i/teamlogos/leagues/500/nba.png",
  mlb:"https://a.espncdn.com/i/teamlogos/leagues/500/mlb.png",
  nhl:"https://a.espncdn.com/i/teamlogos/leagues/500/nhl.png"
};

const TARGET_LOOP_SECONDS = 36;
const MIN_SPEED = 40;
const MAX_SPEED = 120;
const CACHE_TTL = 15000;

/* STATE */
let CACHE = null;
let CACHE_TS = 0;
let rail, railDup, railStaging, tickerBar, viewport;
let x = 0;
let lastTs = null;

/* HELPERS */
function safe(o,p,f=""){ try{return p.split('.').reduce((a,k)=>a[k],o) ?? f;}catch{return f;} }
function pstTimestamp(iso){ return new Date(iso).getTime(); }
function formatDateTimeMMDD(iso){
  const d=new Date(iso);
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const dd=String(d.getDate()).padStart(2,'0');
  let h=d.getHours();
  const m=String(d.getMinutes()).padStart(2,'0');
  const ampm=h>=12?'PM':'AM';
  h=h%12||12;
  return `${mm}/${dd} ${h}:${m} ${ampm}`;
}
function gameState(it){
  if(it.isLive) return 1;
  if((it.statusText||'').toUpperCase().includes('FINAL')) return 2;
  return 0;
}
function periodLabelForLeague(leagueKey, period){
  if(!period && period!==0) return '';
  const p=Number(period);
  if(Number.isFinite(p)){
    if(leagueKey==='mlb') return `In ${p}`;
    if(['nfl','nba','nhl'].includes(leagueKey)) return `Q${p}`;
    return `P${p}`;
  }
  return String(period).toUpperCase();
}

/* FETCH via corsproxy.io */
async function fetchJson(url){
  const proxy="https://corsproxy.io/?";
  try{
    const r=await fetch(proxy+encodeURIComponent(url),{cache:"no-store"});
    if(r.ok) return r.json();
  }catch(e){ console.error(e); }
  return null;
}

/* FETCH SCORES */
async function fetchScores(){
  const now=Date.now();
  if(CACHE && now-CACHE_TS<CACHE_TTL) return CACHE;

  const all=[];
  for(const lg of LEAGUES){
    try{
      const data=await fetchJson(lg.url);
      if(!data) continue;
      for(const ev of (data.events||[])){
        const comp=safe(ev,'competitions.0',null);
        if(!comp) continue;

        const away=comp.competitors.find(t=>t.homeAway==='away');
        const home=comp.competitors.find(t=>t.homeAway==='home');
        if(!away||!home) continue;

        const iso=ev.date||comp.date;
        if(!iso) continue;

        const status=safe(comp,'status.type',{});
        const isLive=safe(status,'state','')==='in';
        const statusText=isLive?'LIVE':safe(status,'shortDetail','');

        const item={
          league:lg.name,
          leagueKey:lg.key,
          iso,
          away:{abbr:away.team.abbreviation,logo:away.team.logo,score:away.score},
          home:{abbr:home.team.abbreviation,logo:home.team.logo,score:home.score},
          isLive,
          statusText,
          period:safe(status,'period','')
        };
        all.push(item);
      }
    }catch(e){ console.error(e); }
  }

  CACHE=all;
  CACHE_TS=Date.now();
  return all;
}

/* RENDERING */
function createPSTPill(){
  const p=document.createElement('span');
  p.className='pill pst-pill';
  p.textContent='All times PST';
  return p;
}

function createGamePill(it){
  const pill=document.createElement('span');
  pill.className='pill';

  const awayLogo=document.createElement('img');
  awayLogo.className='team-logo';
  awayLogo.src=it.away.logo;

  const homeLogo=document.createElement('img');
  homeLogo.className='team-logo';
  homeLogo.src=it.home.logo;

  const away=document.createElement('span');
  away.textContent=it.away.abbr;

  const home=document.createElement('span');
  home.textContent=it.home.abbr;

  const statusInline=document.createElement('div');
  statusInline.className='status-inline';

  const state=gameState(it);

  /* SCORE GOES BETWEEN ABBREVIATIONS */
  let scoreElement=null;

  if(state===0){
    scoreElement=document.createElement('span');
    scoreElement.className='score-text';
    scoreElement.textContent=formatDateTimeMMDD(it.iso);
  }
  else if(state===1){
    scoreElement=document.createElement('div');
    scoreElement.className='score-pair';
    scoreElement.innerHTML=`<span>${it.away.score}</span><span>–</span><span>${it.home.score}</span>`;

    const stack=document.createElement('div');
    stack.className='status-stack';

    const main=document.createElement('div');
    main.className='status-main';
    main.textContent='LIVE';

    const sub=document.createElement('div');
    sub.className='status-sub';
    sub.textContent=periodLabelForLeague(it.leagueKey,it.period);

    stack.appendChild(main);
    stack.appendChild(sub);

    statusInline.appendChild(stack);
  }
  else{
    scoreElement=document.createElement('span');
    scoreElement.className='score-text';
    scoreElement.textContent=`${it.away.score} - ${it.home.score}`;

    const badge=document.createElement('span');
    badge.className='final-badge';
    badge.textContent='FINAL';

    statusInline.appendChild(badge);
  }

  pill.appendChild(awayLogo);
  pill.appendChild(away);
  pill.appendChild(scoreElement);
  pill.appendChild(home);
  pill.appendChild(homeLogo);
  pill.appendChild(statusInline);

  return pill;
}

/* BUILD RAILS */
function buildDoubleRail(items){
  rail.innerHTML='';
  railDup.innerHTML='';

  const pst=createPSTPill();
  rail.appendChild(pst.cloneNode(true));
  railDup.appendChild(pst.cloneNode(true));

  for(const it of items){
    const p=createGamePill(it);
    rail.appendChild(p.cloneNode(true));
    railDup.appendChild(p.cloneNode(true));
  }

  rail.style.transform=`translateX(${x}px)`;
  railDup.style.transform=`translateX(${x+rail.scrollWidth}px)`;
}

/* LOOP */
function loopFrame(ts){
  if(!lastTs) lastTs=ts;
  const dt=(ts-lastTs)/1000;
  lastTs=ts;

  let speed=(rail.scrollWidth||1)/TARGET_LOOP_SECONDS;
  speed=Math.max(MIN_SPEED,Math.min(MAX_SPEED,speed));

  x-=speed*dt;

  const w=rail.scrollWidth||1;
  if(Math.abs(x)>=w) x+=w;

  rail.style.transform=`translateX(${x}px)`;
  railDup.style.transform=`translateX(${x+w}px)`;

  requestAnimationFrame(loopFrame);
}

/* REFRESH */
async function refreshData(){
  const items=await fetchScores();
  if(!items.length) return;

  railStaging.innerHTML='';
  const pst=createPSTPill();
  railStaging.appendChild(pst);

  for(const it of items){
    railStaging.appendChild(createGamePill(it));
  }

  requestAnimationFrame(()=>{
    rail.innerHTML=railStaging.innerHTML;
    railDup.innerHTML=railStaging.innerHTML;
  });
}

/* BOOTSTRAP */
async function bootstrap(){
  rail=document.getElementById('rail');
  railDup=document.getElementById('rail-dup');
  railStaging=document.getElementById('rail-staging');
  tickerBar=document.getElementById('tickerBar');
  viewport=document.getElementById('viewport');

  const items=await fetchScores();
  buildDoubleRail(items);

  requestAnimationFrame(loopFrame);
  setInterval(refreshData,15000);
}

bootstrap();
</script>

</body>
</html>
