<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>NFL on FOX — Retro Broadcast Ticker</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --height:86px;                 /* ticker bar height */
  --padding-y:8px;
  --pill-gap:22px;
  --font-base:24px;
  --stripe-w:8px;
  --speed-px-per-sec:140;
  --bg: rgba(0,0,0,0.30);
  --fox-navy: #05204a;           /* FOX deep navy */
  --fox-gold: #ffb81c;           /* FOX gold accent */
  --pill-bg: rgba(255,255,255,0.03);
  --shadow: rgba(0,0,0,0.30);
}

/* base */
html,body{height:100%; margin:0; padding:0; background:transparent; font-family:"Oswald", "Roboto Condensed", Arial, sans-serif; -webkit-font-smoothing:antialiased;}
.ticker-wrap{
  position:fixed; left:0; right:0; bottom:0;
  height:var(--height);
  display:flex; align-items:center;
  padding:var(--padding-y) 18px;
  box-sizing:border-box;
  background:var(--bg);
  overflow:hidden; z-index:9999;
  border-top:1px solid rgba(255,255,255,0.03);
}

/* moving rail */
.ticker { display:flex; align-items:center; gap:var(--pill-gap); white-space:nowrap; will-change:transform; }

/* pill */
.game-pill{
  display:inline-flex;
  align-items:center;
  gap:12px;
  padding:10px 14px;
  min-height: calc(var(--height) - (var(--padding-y) * 2));
  background:var(--pill-bg);
  border-radius:4px;
  color:#fff;
  box-shadow:0 6px 14px var(--shadow);
  font-size:var(--font-base);
  border-left: 6px solid rgba(255,255,255,0.03);
}

/* FOX left stripe (thicker, navy) */
.game-pill .league-stripe{
  width:var(--stripe-w); height: calc(var(--height) - 28px); border-radius:2px; margin-right:8px;
  background:var(--fox-navy);
}

/* team block */
.team{ display:flex; align-items:center; gap:8px; min-width:120px; }
.team .logo{ width:30px; height:22px; object-fit:contain; display:inline-block; }
.team .abbr{ font-weight:700; letter-spacing:0.02em; font-size:0.98em; }

/* score block — tabular numbers for consistent width */
.score{ display:flex; align-items:center; gap:8px; font-weight:700; font-variant-numeric:tabular-nums; font-feature-settings:"tnum"; }
.score .num{ min-width:40px; text-align:center; display:inline-block; font-size:1.05em; }

/* status block — LIVE badge + text */
.status{ display:flex; align-items:center; gap:10px; min-width:170px; text-transform:uppercase; font-size:0.78em; letter-spacing:0.06em; opacity:0.94; }
.live-badge{ display:inline-flex; align-items:center; gap:8px; padding:6px 8px; border-radius:8px; background:rgba(0,0,0,0.16); font-weight:700; color:var(--fox-gold); }
.live-dot{ width:12px; height:12px; border-radius:50%; background:var(--fox-gold); box-shadow:0 0 8px rgba(255,184,28,0.22); animation:livePulse 1.4s infinite; }
@keyframes livePulse{ 0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)} }

/* round pill */
.round-pill{ display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:6px; font-weight:700; font-size:0.95em; min-height:calc(var(--height) - 18px); background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); color:#fff; box-shadow:0 6px 14px var(--shadow); }
.round-icon{ width:36px; height:28px; background:rgba(255,255,255,0.04); border-radius:6px; display:inline-flex; align-items:center; justify-content:center; }

/* separator */
.separator{ width:10px; height:calc(var(--height) - 36px); background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border-radius:2px; box-shadow:inset 0 -1px rgba(0,0,0,0.25); margin:0 2px; }

/* responsiveness & reduced motion */
@media (max-width:720px){ :root{ --font-base:18px; --pill-gap:12px; --stripe-w:6px; } .team{ min-width:90px } .status{ min-width:110px } }
@media (prefers-reduced-motion:reduce){ .ticker{ animation:none !important } }

</style>
</head>
<body>
<div class="ticker-wrap" id="tickerWrap" aria-live="polite" role="region" aria-label="FOX-style ticker">
  <div id="ticker" class="ticker" aria-hidden="false">Loading…</div>
</div>

<script>
/* CONFIG */
const PIXELS_PER_SECOND = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--speed-px-per-sec')) || 140;
const PAUSE_BETWEEN_LOOPS = 2200;
const leagues = [
  { name: "NFL", url: "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard", color:"#05204a" },
  { name: "NBA", url: "https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard", color:"#05204a" },
  { name: "MLB", url: "https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard", color:"#05204a" },
  { name: "NHL", url: "https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard", color:"#05204a" }
];
const CACHE_TTL = 30000;

/* helpers */
function safe(o, p, f = undefined){ return p.split('.').reduce((x,k)=> (x && x[k] !== undefined ? x[k] : undefined), o) ?? f; }
function formatPST(iso){ if(!iso) return ''; try{ const d=new Date(iso); const local=new Date(d.toLocaleString('en-US',{timeZone:'America/Los_Angeles'})); return local.toLocaleString('en-US',{ month:'numeric', day:'numeric', hour:'numeric', minute:'2-digit', hour12:true }).replace(',', ''); }catch{ return ''; } }
async function fetchJson(url){ try{ const r=await fetch(url,{cache:'no-store'}); if(r.ok) return r.json(); }catch{} try{ const r2=await fetch("https://api.allorigins.win/raw?url="+encodeURIComponent(url)); if(r2.ok) return r2.json(); }catch{} return null; }

/* build DOM nodes */
function buildRoundPillNode(text){ const n=document.createElement('span'); n.className='round-pill'; const ic=document.createElement('span'); ic.className='round-icon'; ic.innerHTML=`<svg width="32" height="20" viewBox="0 0 32 20" xmlns="http://www.w3.org/2000/svg"><rect width="32" height="20" rx="4" fill="rgba(255,255,255,0.04)"/></svg>`; const t=document.createElement('span'); t.textContent=text||'Playoffs'; n.appendChild(ic); n.appendChild(t); return n; }

function buildGameNode(it){
  const pill=document.createElement('span'); pill.className='game-pill';
  const stripe=document.createElement('span'); stripe.className='league-stripe'; stripe.style.background=it.leagueColor||'#05204a'; pill.appendChild(stripe);

  // away
  const away=document.createElement('span'); away.className='team';
  const aLogo=document.createElement(it.away.logo ? 'img' : 'span'); if(it.away.logo){ aLogo.src=it.away.logo; aLogo.alt=it.away.abbr||''; aLogo.className='logo'; } else { aLogo.innerHTML=`<svg width="30" height="22" viewBox="0 0 30 22" xmlns="http://www.w3.org/2000/svg"><rect width="30" height="22" rx="3" fill="#444"/></svg>`; aLogo.className='logo'; }
  away.appendChild(aLogo);
  const aAb=document.createElement('span'); aAb.className='abbr'; aAb.textContent=it.away.abbr||''; away.appendChild(aAb);
  pill.appendChild(away);

  // score
  const score=document.createElement('span'); score.className='score';
  const aNum=document.createElement('span'); aNum.className='num'; aNum.textContent=(it.away.score!==''?it.away.score:'-');
  const dash=document.createElement('span'); dash.textContent='–';
  const hNum=document.createElement('span'); hNum.className='num'; hNum.textContent=(it.home.score!==''?it.home.score:'-');
  score.appendChild(aNum); score.appendChild(dash); score.appendChild(hNum);
  pill.appendChild(score);

  // home
  const home=document.createElement('span'); home.className='team';
  const hAb=document.createElement('span'); hAb.className='abbr'; hAb.textContent=it.home.abbr||'';
  home.appendChild(hAb);
  const hLogo=document.createElement(it.home.logo ? 'img' : 'span'); if(it.home.logo){ hLogo.src=it.home.logo; hLogo.alt=it.home.abbr||''; hLogo.className='logo'; } else { hLogo.innerHTML=`<svg width="30" height="22" viewBox="0 0 30 22" xmlns="http://www.w3.org/2000/svg"><rect width="30" height="22" rx="3" fill="#444"/></svg>`; hLogo.className='logo'; }
  home.appendChild(hLogo);
  pill.appendChild(home);

  // status
  const st=document.createElement('span'); st.className='status';
  if(it.isLive){
    const live=document.createElement('span'); live.className='live-badge';
    const dot=document.createElement('span'); dot.className='live-dot';
    live.appendChild(dot);
    const t=document.createElement('span'); t.textContent='LIVE';
    live.appendChild(t);
    st.appendChild(live);
  }
  const statusText=document.createElement('span'); statusText.textContent=it.statusText || it.kickoff || '';
  st.appendChild(statusText);
  if(it.network){ const net=document.createElement('span'); net.textContent=` • ${it.network}`; net.style.opacity=0.88; st.appendChild(net); }
  pill.appendChild(st);

  return pill;
}

/* main fetch & assemble */
let lastTS=0, cached=null;
async function fetchScores(){
  const now=Date.now(); if(cached && (now-lastTS)<CACHE_TTL){ runTicker(cached); return; }
  const segments=[], playoffGroups={};
  for(const lg of leagues){
    try{
      const data=await fetchJson(lg.url); if(!data) continue;
      const events=(data.events||[]);
      for(const ev of events){
        const comp=safe(ev,'competitions.0',null); if(!comp) continue;
        const away=(comp.competitors||[]).find(t=>t.homeAway==='away'); const home=(comp.competitors||[]).find(t=>t.homeAway==='home'); if(!away||!home) continue;
        const iso=ev.date||comp.date||'';
        const kickoff=iso?formatPST(iso):'';
        const status=safe(comp,'status.type',{}); const state=safe(status,'state',''); const isLive=(state==='in');
        const statusText=isLive?'LIVE':(safe(status,'shortDetail','')||safe(status,'type.text','')||'');
        const broadcasts=safe(comp,'broadcasts',[])||safe(ev,'broadcasts',[])||[]; let network='';
        if(Array.isArray(broadcasts)&&broadcasts.length){ const b=broadcasts.find(b=>b.market==='national')||broadcasts[0]; if(b){ if(Array.isArray(b.names)) network=b.names.slice(0,3).join(', '); else if(b.name) network=b.name; } }
        const awayLogo=safe(away,'team.logo', safe(away,'team.logos.0.href',''))||''; const homeLogo=safe(home,'team.logo', safe(home,'team.logos.0.href',''))||'';
        const awayAbbr=(safe(away,'team.abbreviation', safe(away,'team.displayName',''))||'').toUpperCase(); const homeAbbr=(safe(home,'team.abbreviation', safe(home,'team.displayName',''))||'').toUpperCase();
        const awayScore=(safe(away,'score','')+''); const homeScore=(safe(home,'score','')+'');
        const isPlayoff = safe(ev,'season.type',0) === 3;
        const round = isPlayoff ? (safe(comp,'notes.0.headline','')|| safe(ev,'league.name','Playoffs')) : '';
        const item={ league:lg.name, leagueColor:lg.color, isPlayoff, round, iso, kickoff, network, away:{abbr:awayAbbr,logo:awayLogo,score:awayScore}, home:{abbr:homeAbbr,logo:homeLogo,score:homeScore}, isLive, statusText };
        if(isPlayoff){ playoffGroups[round]=playoffGroups[round]||[]; playoffGroups[round].push(item); } else segments.push(item);
      }
    }catch(e){ console.warn('fetch err', e); }
  }

  const finalList=[];
  const rounds=Object.keys(playoffGroups).sort();
  for(const r of rounds){ const arr=playoffGroups[r].sort((a,b)=>(new Date(a.iso||0)-new Date(b.iso||0))); if(arr.length){ finalList.push({header:r}); finalList.push(...arr); } }
  const regularSorted = segments.sort((a,b)=>(new Date(a.iso||0)-new Date(b.iso||0)));
  if(regularSorted.length){ finalList.push({header:'Regular'}); finalList.push(...regularSorted); }

  // dedupe
  const seen=new Set(); const dedup=[];
  for(const it of finalList){ if(it.header){ dedup.push(it); continue; } const key=`${it.iso}|${it.away.abbr}|${it.home.abbr}`; if(!seen.has(key)){ seen.add(key); dedup.push(it); } }

  cached = dedup; lastTS = Date.now();
  runTicker(dedup);
}

/* build DOM + measured scroll animation */
let dynCounter=0;
function runTicker(list){
  const wrap=document.getElementById('tickerWrap'), t=document.getElementById('ticker');
  t.style.animation='none'; t.innerHTML='';

  if(!list || list.length===0){ t.textContent='No games'; wrap.style.opacity='0.0'; wrap.style.pointerEvents='none'; return; } else { wrap.style.opacity='1'; wrap.style.pointerEvents='auto'; }

  const frag=document.createDocumentFragment();
  list.forEach((it, idx) => {
    if(it.header){ frag.appendChild(buildRoundPillNode(it.header)); }
    else { frag.appendChild(buildGameNode(it)); }
    if(idx !== list.length-1){ const s=document.createElement('span'); s.className='separator'; frag.appendChild(s); }
  });
  t.appendChild(frag);
  void t.offsetWidth;

  const wrapW = wrap.clientWidth, contentW = t.scrollWidth;
  if(contentW <= wrapW){ t.style.transform='translateX(0)'; t.style.justifyContent='center'; setTimeout(()=>{ setTimeout(()=> fetchScores(), PAUSE_BETWEEN_LOOPS); }, PAUSE_BETWEEN_LOOPS); return; }

  const distance = contentW + wrapW;
  const dur = Math.max(6, Math.round(distance / PIXELS_PER_SECOND));
  const startX = wrapW;
  const endX = -contentW;
  const name = `scroll_${++dynCounter}`;
  const old = document.getElementById('dyn-ticker-style'); if(old) old.remove();
  const style = document.createElement('style'); style.id = 'dyn-ticker-style';
  style.textContent = `@keyframes ${name}{ from{transform:translateX(${startX}px)} to{transform:translateX(${endX}px)} }`;
  document.head.appendChild(style);
  t.style.animationName = name;
  t.style.animationDuration = `${dur}s`;
  t.style.animationTimingFunction = 'linear';
  t.style.animationFillMode = 'forwards';
  t.addEventListener('animationend', function done(){ t.removeEventListener('animationend', done); setTimeout(()=>{ fetchScores(); }, PAUSE_BETWEEN_LOOPS); });
}

/* bootstrap */
fetchScores();
setInterval(()=>fetchScores(), 85_000); // periodic refresh for long-running sessions

/* small helper export */
function safe(o,p,f){ return safe; }
</script>
</body>
</html>
